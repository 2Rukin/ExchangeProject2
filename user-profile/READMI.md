<h2>В данный момент основной модуль - все классы и пакеты создаем в этом модуле</h2>
<h3>Добавление Liquibase для создания таблицы модели </h3>
- Добавление зависимости(зависимость уже добавлена).
- Создание в resources папки changelog и добавление файла db.changelog-master.yaml(сделано).
- в db.changelog-master.yaml добавляем путь к скрипту который будет отвечать за создание таблицы.
- создаем сам скрипт, название должно соответствовать тому что он делает(create-tariff-table.yaml смотрим пример).
- запускаем, таблица вашей модели создана

<h2>Описание user-service</h2>
В данном сервисе происходит работа с пользователями, советы для более быстрого старта:
1. Просмотреть [плейлист про OAuth2 и Keycloak](https://www.youtube.com/watch?v=IP-KnVvweaA&list=PL8X2nqRlWfaZbGSfSCnNyQ7g5VW3irLjX) и [плейлист про микросервисы](https://www.youtube.com/watch?v=_2W43xoyWOw&list=PL8X2nqRlWfaZcyrJrsrWmQ17vtagWKv3f) и прочитать книгу из закрепа в слаке "Микросервисы Spring в действии".
2. Создание пользователей и основная работа с keycloak расписана в основном readme так, что здесь добавлю только, то что в основном мне требовались только панели Realm Settings, Clients и Users.
3. Скорее всего, тебе придется проверять свои контроллеры в POSTMAN, а для этого нужен access token. В плейлисте про OAuth2 и Keycloak внимательно просмотри видео про то, как достать access token + в книге, в главе "безопасность микросервисов" есть более легкий способ получения токена. 
На данным момент через postman нельзя проверить конечные точки(контроллеры) через порт 8080(gateway), только напрямую через рандомный порт, который выдает IDEA. 
Swagger решает эту проблему, но там есть своё "НО" + он имеет меньше функционала. Проблема заключается в том, что при попытке зайти на свой микросервис через 8080, POSTMAN не прокидывает токен до нужного нам микросервиса, а браузер это делает автоматически.
4. Немного про авторизацию и созданию пользователей:
   - keycloak имеет свою дефолтную страницу авторизации и регистрации, чтобы попасть на страницу авторизации, достаточно будет перейти по любой ссылке на порту 8080, там же будет ссылка на регистрацию пользователя.
   - При создании пользователя вручную через панель админа и регистрации, пользователь по дефолту имеет роль "default-roles-project-realm", которая в себе имеет роль USER, благодаря ей мы можем попасть на контроллеры с уровнем доступа USER. 
Также через панель админа мы можем дать пользователю роль ADMIN и USER(роль user будто продублирована, зачем так я понятия не имею, так было до меня).
   - Не забывай про **обязательные** поля при создании через панель админа: username, email, first и last name.
5. Перейдем к запуску: 
   - В docker для работы нашего сервиса понадобится 3 контейнера - postgres-1, keycloak-1 и postgres-keycloak-1 (в закрепе слака есть видео по запуску проекта через docker). 
   - Запускаем server, после config, а далее порядок уже не важен, но нам останется запустить только gateway и UserProfile.
6. После запуска переходим в keycloak и создаем пользователя во вкладке Users, затем переходим на порт 8080 и авторизуемся, если у тебя всё получилось, то в ответе придёт json с твоим созданным пользователем.
7. Теперь нужно понять как это пока работает:
   - Подключись к бд через IDEA, данные я писал в основном readme.
   - Расставь брейкпоинты на контроллере api/user/home и методе getClaims и ОБЯЗАТЕЛЬНО сделай дебаг, чтобы понять, как пользователи попадают в нашу бд users.
   - Пойми почему будет ошибка, если в keycloak не создать обязательные поля.
   - Просмотри мапу, которую возвращает метод getClaims.
8. Таблицы создаются, благодаря YML файлам в папке src/main/resources/db/changelog/changeset, я заметил небольшие не состыковки с Entity и бд, которые создают YML файлы, будь аккуратен.
9. Просмотри keycloak-server/realm-export.json данный файл, это почти дефолтная настройка keycloak, когда создается контейнер в Docker. Возможно, его придется редактировать.